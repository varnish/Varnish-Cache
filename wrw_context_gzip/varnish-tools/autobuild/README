Automatic Build and Test Utility
================================

The tools found in this directory may be used to automate periodic
building and regression testing of Varnish.


Cron-based Invocation
---------------------

Start by installing autobuild.sh, mksummary.pl, and summary.html into
an empty directory and configure cron(8) to run this new copy of
autobuild.sh periodically.

autobuild.sh will start by looking up the most recent revision number
on the Subversion server and compare this number to the revision
number of the last autobuild, which is kept in a file called
LAST_TESTED_REVISION.

If the numbers are identical, autobuild.sh will exit and be done.

If not, the new revision is checked out, configured, built, installed
into a directory tree under /tmp, and finally, tested using the
regression test framework.

The test result is extracted and the summary file, index.html is
updated with the new result.

A web-server may be used to make index.html and the sub-directories
(which are the working directories of the individual autobuild runs)
available to the world.


Manual Invocation
-----------------

autobuild.sh may also be invoked manually and takes an optional
argument which will be interpreted as a Subversion revision number.
This revision will then be processed in the same way as described
above.


Working Directories
-------------------

Each time autobuild.sh builds and tests a revision, a working
directory is created inside the directory where autobuild.sh is
located. This working directory is used to hold the checked-out
revision as well as log files generated during building and testing.
The name of the working directory indicates the time (UTC) of its
creation.

In addition to the checked-out revision residing in the sub-directory
"trunk", the following files are stored in a working directory:

  svn.log - output to STDOUT and STDERR during Subversion checkout
  build.log - output to STDOUT and STDERR during configure, build, and install
  regress.log - output to STDOUT and STDERR during regression testing
  regress.bin - Varnish's storage cache file during regression testing
  regress.html - HTML-formatted result of regression testing
  regress.status - summary of regress.html, used by mksummary.pl


Summary file
------------

Currently, the overall summary file, index.html, is generated from
scratch based on the currently present working directories, every time
autobuild.sh completes successfully. The summary file is generated by
the Perl script called mksummary.pl, using summary.html as template.
